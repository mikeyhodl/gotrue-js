"use strict";var GoTrue=(()=>{var w=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var S=(n,e)=>{for(var r in e)w(n,r,{get:e[r],enumerable:!0})},P=(n,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of b(e))!R.call(n,t)&&t!==r&&w(n,t,{get:()=>e[t],enumerable:!(s=U(e,t))||s.enumerable});return n};var v=n=>P(w({},"__esModule",{value:!0}),n);var A={};S(A,{Admin:()=>d,HTTPError:()=>h,JSONHTTPError:()=>o,TextHTTPError:()=>l,User:()=>a,default:()=>T});var h=class extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.status=e.status}},l=class extends h{constructor(e,r){super(e),this.name="TextHTTPError",this.data=r}},o=class extends h{constructor(e,r){super(e),this.name="JSONHTTPError",this.json=r}},c=class n{constructor(e,r){this.apiURL=e||"",this._sameOrigin=/^\/(?!\/)/.test(this.apiURL),this.defaultHeaders=r?.defaultHeaders||{}}headers(e={}){return{...this.defaultHeaders,"Content-Type":"application/json",...e}}static async parseJsonResponse(e){let r=await e.json();if(!e.ok)throw new o(e,r);return r}async request(e,r={}){let s=this.headers(r.headers||{}),t={...r,headers:s};this._sameOrigin&&(t.credentials=r.credentials||"same-origin");let i=await fetch(this.apiURL+e,t);if(i.headers.get("Content-Type")?.includes("json"))return n.parseJsonResponse(i);let g=await i.text();if(!i.ok)throw new l(i,g);return g}};var d=class{constructor(e){this.user=e}listUsers(e){return this.user._request("/admin/users",{method:"GET",audience:e})}getUser(e){return this.user._request(`/admin/users/${e.id}`)}updateUser(e,r={}){return this.user._request(`/admin/users/${e.id}`,{method:"PUT",body:JSON.stringify(r)})}createUser(e,r,s={}){return s.email=e,s.password=r,this.user._request("/admin/users",{method:"POST",body:JSON.stringify(s)})}deleteUser(e){return this.user._request(`/admin/users/${e.id}`,{method:"DELETE"})}};var x=60*1e3,p="gotrue.user",k={},m=null,O={api:1,token:1,audience:1,url:1},q={api:1},f=()=>typeof window<"u",y=!1;function _(){!y&&f()&&(y=!0,window.addEventListener("storage",n=>{n.key===p&&(m=null)}))}var a=class n{constructor(e,r,s){this.token=null;this.api=e,this.url=e.apiURL,this.audience=s,this._processTokenResponse(r),m=this,_()}static removeSavedSession(){f()&&localStorage.removeItem(p)}static recoverSession(e){if(_(),m)return m;let r=f()&&localStorage.getItem(p);if(r)try{let s=JSON.parse(r),{url:t,token:i,audience:u}=s;if(!t||!i)return null;let g=e||new c(t,{});return new n(g,i,u)._saveUserData(s,!0)}catch(s){return console.error(new Error(`Gotrue-js: Error recovering session: ${s}`)),null}return null}get admin(){return new d(this)}async update(e){let r=await this._request("/user",{method:"PUT",body:JSON.stringify(e)});return this._saveUserData(r)._refreshSavedSession()}jwt(e){let r=this.tokenDetails();if(r==null)return Promise.reject(new Error("Gotrue-js: failed getting jwt access token"));let{expires_at:s,refresh_token:t,access_token:i}=r;return e||s-x<Date.now()?this._refreshToken(t):Promise.resolve(i)}logout(){return this._request("/logout",{method:"POST"}).then(this.clearSession.bind(this)).catch(this.clearSession.bind(this))}_refreshToken(e){let r=k[e];if(r)return r;let s=this.api.request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&refresh_token=${e}`}),t=new Promise((u,g)=>{setTimeout(()=>g(new Error("Token refresh timeout")),3e4)}),i=Promise.race([s,t]).then(u=>{if(delete k[e],this._processTokenResponse(u),this._refreshSavedSession(),!this.token)throw new Error("Gotrue-js: Token not set after refresh");return this.token.access_token}).catch(u=>{throw delete k[e],this.clearSession(),u});return k[e]=i,i}async _request(e,r={}){r.headers=r.headers||{};let s=r.audience||this.audience;s&&(r.headers["X-JWT-AUD"]=s);try{let t=await this.jwt();return await this.api.request(e,{headers:Object.assign(r.headers,{Authorization:`Bearer ${t}`}),...r})}catch(t){throw t instanceof o&&t.json&&(t.json.msg?t.message=t.json.msg:t.json.error&&(t.message=`${t.json.error}: ${t.json.error_description}`)),t}}async getUserData(){let e=await this._request("/user");return this._saveUserData(e)._refreshSavedSession()}_saveUserData(e,r){for(let s in e)s in n.prototype||s in O||(this[s]=e[s]);return r&&(this._fromStorage=!0),this}_processTokenResponse(e){this.token=e;try{let r=JSON.parse(D(e.access_token.split(".")[1]));this.token.expires_at=r.exp*1e3}catch(r){console.error(new Error(`Gotrue-js: Failed to parse tokenResponse claims: ${r}`))}}_refreshSavedSession(){return f()&&localStorage.getItem(p)&&this._saveSession(),this}get _details(){let e={};for(let r in this)r in n.prototype||r in q||(e[r]=this[r]);return e}_saveSession(){return f()&&localStorage.setItem(p,JSON.stringify(this._details)),this}tokenDetails(){return this.token}clearSession(){n.removeSavedSession(),this.token=null,m=null}};function j(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString("binary")}function D(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Illegal base64url string!")}let r=j(e);try{let s=Uint8Array.from(r,t=>t.codePointAt(0)??0);return new TextDecoder().decode(s)}catch{return r}}var E=/^http:\/\//,H="/.netlify/identity",T=class{constructor({APIUrl:e=H,audience:r="",setCookie:s=!1}={}){E.test(e)&&console.warn(`Warning:

DO NOT USE HTTP IN PRODUCTION FOR GOTRUE EVER!
GoTrue REQUIRES HTTPS to work securely.`),r&&(this.audience=r),this.setCookie=s,this.api=new c(e)}async _request(e,r={}){r.headers=r.headers||{};let s=r.audience||this.audience;s&&(r.headers["X-JWT-AUD"]=s);try{return await this.api.request(e,r)}catch(t){throw t instanceof o&&t.json&&(t.json.msg?t.message=t.json.msg:t.json.error&&(t.message=`${t.json.error}: ${t.json.error_description}`)),t}}settings(){return this._request("/settings")}signup(e,r,s){return this._request("/signup",{method:"POST",body:JSON.stringify({email:e,password:r,data:s})})}login(e,r,s){return this._setRememberHeaders(s),this._request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=password&username=${encodeURIComponent(e)}&password=${encodeURIComponent(r)}`}).then(t=>(a.removeSavedSession(),this.createUser(t,s)))}loginExternalUrl(e){return`${this.api.apiURL}/authorize?provider=${e}`}confirm(e,r){return this._setRememberHeaders(r),this.verify("signup",e,r)}requestPasswordRecovery(e){return this._request("/recover",{method:"POST",body:JSON.stringify({email:e})})}recover(e,r){return this._setRememberHeaders(r),this.verify("recovery",e,r)}acceptInvite(e,r,s){return this._setRememberHeaders(s),this._request("/verify",{method:"POST",body:JSON.stringify({token:e,password:r,type:"signup"})}).then(t=>this.createUser(t,s))}acceptInviteExternalUrl(e,r){return`${this.api.apiURL}/authorize?provider=${e}&invite_token=${r}`}createUser(e,r=!1){return this._setRememberHeaders(r),new a(this.api,e,this.audience||"").getUserData().then(t=>(r&&t._saveSession(),t))}currentUser(){let e=a.recoverSession(this.api);return e&&this._setRememberHeaders(e._fromStorage),e}verify(e,r,s){return this._setRememberHeaders(s),this._request("/verify",{method:"POST",body:JSON.stringify({token:r,type:e})}).then(t=>this.createUser(t,s))}_setRememberHeaders(e){this.setCookie&&(this.api.defaultHeaders=this.api.defaultHeaders||{},this.api.defaultHeaders["X-Use-Cookie"]=e?"1":"session")}};typeof window<"u"&&(window.GoTrue=T);return v(A);})();
