"use strict";var GoTrue=(()=>{var A=Object.create;var p=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var j=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),L=(s,e)=>{for(var t in e)p(s,t,{get:e[t],enumerable:!0})},x=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of N(e))!G.call(s,n)&&n!==t&&p(s,n,{get:()=>e[n],enumerable:!(r=J(e,n))||r.enumerable});return s};var E=(s,e,t)=>(t=s!=null?A($(s)):{},x(e||!s||!s.__esModule?p(t,"default",{value:s,enumerable:!0}):t,s)),C=s=>x(p({},"__esModule",{value:!0}),s);var H=j(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});var B=(function(){function s(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u=e[Symbol.iterator](),c;!(n=(c=u.next()).done)&&(r.push(c.value),!(t&&r.length===t));n=!0);}catch(k){o=!0,i=k}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return s(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})();w.getPagination=W;function W(s){var e=s.headers.get("Link"),t={};if(e==null)return null;e=e.split(",");for(var r=s.headers.get("X-Total-Count"),n=0,o=e.length;n<o;n++){var i=e[n].replace(/(^\s*|\s*$)/,""),u=i.split(";"),c=B(u,2),k=c[0],h=c[1],R=k.match(/page=(\d+)/),g=R&&parseInt(R[1],10);h.match(/last/)?t.last=g:h.match(/next/)?t.next=g:h.match(/prev/)?t.prev=g:h.match(/first/)&&(t.first=g)}return t.last=Math.max(t.last||0,t.prev&&t.prev+1||0),t.current=t.next?t.next-1:t.last||1,t.total=r?parseInt(r,10):null,t}});var O=j(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.JSONHTTPError=a.TextHTTPError=a.HTTPError=a.getPagination=void 0;var q=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},M=(function(){function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}})(),I=H();Object.defineProperty(a,"getPagination",{enumerable:!0,get:function(){return I.getPagination}});function m(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function U(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:s}function S(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):s.__proto__=e)}function X(s){function e(){var t=Reflect.construct(s,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(s.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s,e}var D=a.HTTPError=(function(s){S(e,s);function e(t){m(this,e);var r=U(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.statusText));return r.name=r.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(r,r.constructor):r.stack=new Error(t.statusText).stack,r.status=t.status,r}return e})(X(Error)),z=a.TextHTTPError=(function(s){S(e,s);function e(t,r){m(this,e);var n=U(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.data=r,n}return e})(D),F=a.JSONHTTPError=(function(s){S(e,s);function e(t,r){m(this,e);var n=U(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.json=r,n}return e})(D),K=(function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments[1];m(this,s),this.apiURL=e,this.apiURL.match(/\/[^\/]?/)&&(this._sameOrigin=!0),this.defaultHeaders=t&&t.defaultHeaders||{}}return M(s,[{key:"headers",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q({},this.defaultHeaders,{"Content-Type":"application/json"},t)}},{key:"parseJsonResponse",value:function(t){return t.json().then(function(r){if(!t.ok)return Promise.reject(new F(t,r));var n=(0,I.getPagination)(t);return n?{pagination:n,items:r}:r})}},{key:"request",value:function(t){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.headers(n.headers||{});return this._sameOrigin&&(n.credentials=n.credentials||"same-origin"),fetch(this.apiURL+t,q({},n,{headers:o})).then(function(i){var u=i.headers.get("Content-Type");return u&&u.match(/json/)?r.parseJsonResponse(i):i.ok?i.text().then(function(c){}):i.text().then(function(c){return Promise.reject(new z(i,c))})})}}]),s})();a.default=K});var re={};L(re,{Admin:()=>l,User:()=>d,default:()=>f});var P=E(O());var b=E(O());var l=class{constructor(e){this.user=e}listUsers(e){return this.user._request("/admin/users",{method:"GET",audience:e})}getUser(e){return this.user._request(`/admin/users/${e.id}`)}updateUser(e,t={}){return this.user._request(`/admin/users/${e.id}`,{method:"PUT",body:JSON.stringify(t)})}createUser(e,t,r={}){return r.email=e,r.password=t,this.user._request("/admin/users",{method:"POST",body:JSON.stringify(r)})}deleteUser(e){return this.user._request(`/admin/users/${e.id}`,{method:"DELETE"})}};var Q=60*1e3,y="gotrue.user",_={},T=null,V={api:1,token:1,audience:1,url:1},Y={api:1},v=()=>typeof window<"u",d=class s{constructor(e,t,r){this.api=e,this.url=e.apiURL,this.audience=r,this._processTokenResponse(t),T=this}static removeSavedSession(){v()&&localStorage.removeItem(y)}static recoverSession(e){if(T)return T;let t=v()&&localStorage.getItem(y);if(t)try{let r=JSON.parse(t),{url:n,token:o,audience:i}=r;if(!n||!o)return null;let u=e||new b.default(n,{});return new s(u,o,i)._saveUserData(r,!0)}catch(r){return console.error(new Error(`Gotrue-js: Error recovering session: ${r}`)),null}return null}get admin(){return new l(this)}async update(e){let t=await this._request("/user",{method:"PUT",body:JSON.stringify(e)});return this._saveUserData(t)._refreshSavedSession()}jwt(e){let t=this.tokenDetails();if(t==null)return Promise.reject(new Error("Gotrue-js: failed getting jwt access token"));let{expires_at:r,refresh_token:n,access_token:o}=t;return e||r-Q<Date.now()?this._refreshToken(n):Promise.resolve(o)}logout(){return this._request("/logout",{method:"POST"}).then(this.clearSession.bind(this)).catch(this.clearSession.bind(this))}_refreshToken(e){let t=_[e];if(t)return t;let r=this.api.request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&refresh_token=${e}`}).then(n=>(delete _[e],this._processTokenResponse(n),this._refreshSavedSession(),this.token.access_token)).catch(n=>{throw delete _[e],this.clearSession(),n});return _[e]=r,r}async _request(e,t={}){t.headers=t.headers||{};let r=t.audience||this.audience;r&&(t.headers["X-JWT-AUD"]=r);try{let n=await this.jwt();return await this.api.request(e,{headers:Object.assign(t.headers,{Authorization:`Bearer ${n}`}),...t})}catch(n){throw n instanceof b.JSONHTTPError&&n.json&&(n.json.msg?n.message=n.json.msg:n.json.error&&(n.message=`${n.json.error}: ${n.json.error_description}`)),n}}async getUserData(){let e=await this._request("/user");return this._saveUserData(e)._refreshSavedSession()}_saveUserData(e,t){for(let r in e)r in s.prototype||r in V||(this[r]=e[r]);return t&&(this._fromStorage=!0),this}_processTokenResponse(e){this.token=e;try{let t=JSON.parse(Z(e.access_token.split(".")[1]));this.token.expires_at=t.exp*1e3}catch(t){console.error(new Error(`Gotrue-js: Failed to parse tokenResponse claims: ${t}`))}}_refreshSavedSession(){return v()&&localStorage.getItem(y)&&this._saveSession(),this}get _details(){let e={};for(let t in this)t in s.prototype||t in Y||(e[t]=this[t]);return e}_saveSession(){return v()&&localStorage.setItem(y,JSON.stringify(this._details)),this}tokenDetails(){return this.token}clearSession(){s.removeSavedSession(),this.token=null,T=null}};function Z(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Illegal base64url string!")}let t=window.atob(e);try{return decodeURIComponent(escape(t))}catch{return t}}var ee=/^http:\/\//,te="/.netlify/identity",f=class{constructor({APIUrl:e=te,audience:t="",setCookie:r=!1}={}){ee.test(e)&&console.warn(`Warning:

DO NOT USE HTTP IN PRODUCTION FOR GOTRUE EVER!
GoTrue REQUIRES HTTPS to work securely.`),t&&(this.audience=t),this.setCookie=r,this.api=new P.default(e)}async _request(e,t={}){t.headers=t.headers||{};let r=t.audience||this.audience;r&&(t.headers["X-JWT-AUD"]=r);try{return await this.api.request(e,t)}catch(n){throw n instanceof P.JSONHTTPError&&n.json&&(n.json.msg?n.message=n.json.msg:n.json.error&&(n.message=`${n.json.error}: ${n.json.error_description}`)),n}}settings(){return this._request("/settings")}signup(e,t,r){return this._request("/signup",{method:"POST",body:JSON.stringify({email:e,password:t,data:r})})}login(e,t,r){return this._setRememberHeaders(r),this._request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=password&username=${encodeURIComponent(e)}&password=${encodeURIComponent(t)}`}).then(n=>(d.removeSavedSession(),this.createUser(n,r)))}loginExternalUrl(e){return`${this.api.apiURL}/authorize?provider=${e}`}confirm(e,t){return this._setRememberHeaders(t),this.verify("signup",e,t)}requestPasswordRecovery(e){return this._request("/recover",{method:"POST",body:JSON.stringify({email:e})})}recover(e,t){return this._setRememberHeaders(t),this.verify("recovery",e,t)}acceptInvite(e,t,r){return this._setRememberHeaders(r),this._request("/verify",{method:"POST",body:JSON.stringify({token:e,password:t,type:"signup"})}).then(n=>this.createUser(n,r))}acceptInviteExternalUrl(e,t){return`${this.api.apiURL}/authorize?provider=${e}&invite_token=${t}`}createUser(e,t=!1){return this._setRememberHeaders(t),new d(this.api,e,this.audience||"").getUserData().then(n=>(t&&n._saveSession(),n))}currentUser(){let e=d.recoverSession(this.api);return e&&this._setRememberHeaders(e._fromStorage),e}verify(e,t,r){return this._setRememberHeaders(r),this._request("/verify",{method:"POST",body:JSON.stringify({token:t,type:e})}).then(n=>this.createUser(n,r))}_setRememberHeaders(e){this.setCookie&&(this.api.defaultHeaders=this.api.defaultHeaders||{},this.api.defaultHeaders["X-Use-Cookie"]=e?"1":"session")}};typeof window<"u"&&(window.GoTrue=f);return C(re);})();
