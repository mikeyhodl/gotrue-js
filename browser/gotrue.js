var GoTrue=(()=>{var N=Object.create;var m=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var U=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),C=(s,e)=>{for(var t in e)m(s,t,{get:e[t],enumerable:!0})},R=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of D(e))!L.call(s,n)&&n!==t&&m(s,n,{get:()=>e[n],enumerable:!(r=$(e,n))||r.enumerable});return s};var H=(s,e,t)=>(t=s!=null?N(A(s)):{},R(e||!s||!s.__esModule?m(t,"default",{value:s,enumerable:!0}):t,s)),G=s=>R(m({},"__esModule",{value:!0}),s);var x=U(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});var B=(function(){function s(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u=e[Symbol.iterator](),c;!(n=(c=u.next()).done)&&(r.push(c.value),!(t&&r.length===t));n=!0);}catch(b){o=!0,i=b}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return s(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})();w.getPagination=M;function M(s){var e=s.headers.get("Link"),t={};if(e==null)return null;e=e.split(",");for(var r=s.headers.get("X-Total-Count"),n=0,o=e.length;n<o;n++){var i=e[n].replace(/(^\s*|\s*$)/,""),u=i.split(";"),c=B(u,2),b=c[0],p=c[1],E=b.match(/page=(\d+)/),g=E&&parseInt(E[1],10);p.match(/last/)?t.last=g:p.match(/next/)?t.next=g:p.match(/prev/)?t.prev=g:p.match(/first/)&&(t.first=g)}return t.last=Math.max(t.last||0,t.prev&&t.prev+1||0),t.current=t.next?t.next-1:t.last||1,t.total=r?parseInt(r,10):null,t}});var k=U(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.JSONHTTPError=a.TextHTTPError=a.HTTPError=a.getPagination=void 0;var q=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},X=(function(){function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}})(),J=x();Object.defineProperty(a,"getPagination",{enumerable:!0,get:function(){return J.getPagination}});function y(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function P(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:s}function j(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):s.__proto__=e)}function z(s){function e(){var t=Reflect.construct(s,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(s.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s,e}var I=a.HTTPError=(function(s){j(e,s);function e(t){y(this,e);var r=P(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.statusText));return r.name=r.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(r,r.constructor):r.stack=new Error(t.statusText).stack,r.status=t.status,r}return e})(z(Error)),W=a.TextHTTPError=(function(s){j(e,s);function e(t,r){y(this,e);var n=P(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.data=r,n}return e})(I),F=a.JSONHTTPError=(function(s){j(e,s);function e(t,r){y(this,e);var n=P(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.json=r,n}return e})(I),K=(function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments[1];y(this,s),this.apiURL=e,this.apiURL.match(/\/[^\/]?/)&&(this._sameOrigin=!0),this.defaultHeaders=t&&t.defaultHeaders||{}}return X(s,[{key:"headers",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q({},this.defaultHeaders,{"Content-Type":"application/json"},t)}},{key:"parseJsonResponse",value:function(t){return t.json().then(function(r){if(!t.ok)return Promise.reject(new F(t,r));var n=(0,J.getPagination)(t);return n?{pagination:n,items:r}:r})}},{key:"request",value:function(t){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.headers(n.headers||{});return this._sameOrigin&&(n.credentials=n.credentials||"same-origin"),fetch(this.apiURL+t,q({},n,{headers:o})).then(function(i){var u=i.headers.get("Content-Type");return u&&u.match(/json/)?r.parseJsonResponse(i):i.ok?i.text().then(function(c){}):i.text().then(function(c){return Promise.reject(new W(i,c))})})}}]),s})();a.default=K});var re={};C(re,{default:()=>l});var O=H(k());var S=H(k());var f=class{constructor(e){this.user=e}listUsers(e){return this.user._request("/admin/users",{method:"GET",audience:e})}getUser(e){return this.user._request(`/admin/users/${e.id}`)}updateUser(e,t={}){return this.user._request(`/admin/users/${e.id}`,{method:"PUT",body:JSON.stringify(t)})}createUser(e,t,r={}){return r.email=e,r.password=t,this.user._request("/admin/users",{method:"POST",body:JSON.stringify(r)})}deleteUser(e){return this.user._request(`/admin/users/${e.id}`,{method:"DELETE"})}};var Q=60*1e3,v="gotrue.user",d={},_=null,V={api:1,token:1,audience:1,url:1},Y={api:1},T=()=>typeof window<"u",h=class s{constructor(e,t,r){this.api=e,this.url=e.apiURL,this.audience=r,this._processTokenResponse(t),_=this}static removeSavedSession(){T()&&localStorage.removeItem(v)}static recoverSession(e){if(_)return _;let t=T()&&localStorage.getItem(v);if(t)try{let r=JSON.parse(t),{url:n,token:o,audience:i}=r;if(!n||!o)return null;let u=e||new S.default(n,{});return new s(u,o,i)._saveUserData(r,!0)}catch(r){return console.error(new Error(`Gotrue-js: Error recovering session: ${r}`)),null}return null}get admin(){return new f(this)}update(e){return this._request("/user",{method:"PUT",body:JSON.stringify(e)}).then(t=>this._saveUserData(t)._refreshSavedSession())}jwt(e){let t=this.tokenDetails();if(t==null)return Promise.reject(new Error("Gotrue-js: failed getting jwt access token"));let{expires_at:r,refresh_token:n,access_token:o}=t;return e||r-Q<Date.now()?this._refreshToken(n):Promise.resolve(o)}logout(){return this._request("/logout",{method:"POST"}).then(this.clearSession.bind(this)).catch(this.clearSession.bind(this))}_refreshToken(e){return d[e]?d[e]:d[e]=this.api.request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&refresh_token=${e}`}).then(t=>(delete d[e],this._processTokenResponse(t),this._refreshSavedSession(),this.token.access_token)).catch(t=>{throw delete d[e],this.clearSession(),t})}async _request(e,t={}){t.headers=t.headers||{};let r=t.audience||this.audience;r&&(t.headers["X-JWT-AUD"]=r);try{let n=await this.jwt();return await this.api.request(e,{headers:Object.assign(t.headers,{Authorization:`Bearer ${n}`}),...t})}catch(n){throw n instanceof S.JSONHTTPError&&n.json&&(n.json.msg?n.message=n.json.msg:n.json.error&&(n.message=`${n.json.error}: ${n.json.error_description}`)),n}}getUserData(){return this._request("/user").then(this._saveUserData.bind(this)).then(this._refreshSavedSession.bind(this))}_saveUserData(e,t){for(let r in e)r in s.prototype||r in V||(this[r]=e[r]);return t&&(this._fromStorage=!0),this}_processTokenResponse(e){this.token=e;try{let t=JSON.parse(Z(e.access_token.split(".")[1]));this.token.expires_at=t.exp*1e3}catch(t){console.error(new Error(`Gotrue-js: Failed to parse tokenResponse claims: ${t}`))}}_refreshSavedSession(){return T()&&localStorage.getItem(v)&&this._saveSession(),this}get _details(){let e={};for(let t in this)t in s.prototype||t in Y||(e[t]=this[t]);return e}_saveSession(){return T()&&localStorage.setItem(v,JSON.stringify(this._details)),this}tokenDetails(){return this.token}clearSession(){s.removeSavedSession(),this.token=null,_=null}};function Z(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}let t=window.atob(e);try{return decodeURIComponent(escape(t))}catch{return t}}var ee=/^http:\/\//,te="/.netlify/identity",l=class{constructor({APIUrl:e=te,audience:t="",setCookie:r=!1}={}){ee.test(e)&&console.warn(`Warning:

DO NOT USE HTTP IN PRODUCTION FOR GOTRUE EVER!
GoTrue REQUIRES HTTPS to work securely.`),t&&(this.audience=t),this.setCookie=r,this.api=new O.default(e)}async _request(e,t={}){t.headers=t.headers||{};let r=t.audience||this.audience;r&&(t.headers["X-JWT-AUD"]=r);try{return await this.api.request(e,t)}catch(n){throw n instanceof O.JSONHTTPError&&n.json&&(n.json.msg?n.message=n.json.msg:n.json.error&&(n.message=`${n.json.error}: ${n.json.error_description}`)),n}}settings(){return this._request("/settings")}signup(e,t,r){return this._request("/signup",{method:"POST",body:JSON.stringify({email:e,password:t,data:r})})}login(e,t,r){return this._setRememberHeaders(r),this._request("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=password&username=${encodeURIComponent(e)}&password=${encodeURIComponent(t)}`}).then(n=>(h.removeSavedSession(),this.createUser(n,r)))}loginExternalUrl(e){return`${this.api.apiURL}/authorize?provider=${e}`}confirm(e,t){return this._setRememberHeaders(t),this.verify("signup",e,t)}requestPasswordRecovery(e){return this._request("/recover",{method:"POST",body:JSON.stringify({email:e})})}recover(e,t){return this._setRememberHeaders(t),this.verify("recovery",e,t)}acceptInvite(e,t,r){return this._setRememberHeaders(r),this._request("/verify",{method:"POST",body:JSON.stringify({token:e,password:t,type:"signup"})}).then(n=>this.createUser(n,r))}acceptInviteExternalUrl(e,t){return`${this.api.apiURL}/authorize?provider=${e}&invite_token=${t}`}createUser(e,t=!1){return this._setRememberHeaders(t),new h(this.api,e,this.audience).getUserData().then(n=>(t&&n._saveSession(),n))}currentUser(){let e=h.recoverSession(this.api);return e&&this._setRememberHeaders(e._fromStorage),e}verify(e,t,r){return this._setRememberHeaders(r),this._request("/verify",{method:"POST",body:JSON.stringify({token:t,type:e})}).then(n=>this.createUser(n,r))}_setRememberHeaders(e){this.setCookie&&(this.api.defaultHeaders=this.api.defaultHeaders||{},this.api.defaultHeaders["X-Use-Cookie"]=e?"1":"session")}};typeof window<"u"&&(window.GoTrue=l);return G(re);})();
